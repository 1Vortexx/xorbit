<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>X-ORBIT Music Player</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #121212;
        color: #fff;
        overflow: hidden;
        height: 100vh;
      }

      /* Login Screen */
      .login-screen {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background: linear-gradient(135deg, #1db954 0%, #191414 100%);
      }

      .login-container {
        text-align: center;
        padding: 40px;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 20px;
        backdrop-filter: blur(10px);
      }

      .login-container h1 {
        font-size: 48px;
        margin-bottom: 10px;
        background: linear-gradient(135deg, #1db954, #1ed760);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .login-container p {
        color: #b3b3b3;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .login-btn {
        background: #1db954;
        color: white;
        border: none;
        padding: 15px 50px;
        border-radius: 500px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .login-btn:hover {
        background: #1ed760;
        transform: scale(1.05);
      }

      /* Main Player */
      .player-container {
        display: none;
        height: 100vh;
        flex-direction: column;
      }

      /* Top Bar */
      .top-bar {
        background: #000;
        padding: 15px 30px;
        display: flex;
        align-items: center;
        gap: 20px;
        border-bottom: 1px solid #282828;
      }

      .search-container {
        flex: 1;
        max-width: 500px;
      }

      .search-input {
        width: 100%;
        padding: 12px 20px;
        border-radius: 500px;
        border: none;
        background: #242424;
        color: white;
        font-size: 14px;
        outline: none;
      }

      .search-input:focus {
        background: #2a2a2a;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #b3b3b3;
      }

      .logout-btn {
        background: transparent;
        color: #b3b3b3;
        border: 1px solid #535353;
        padding: 8px 20px;
        border-radius: 500px;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.3s;
      }

      .logout-btn:hover {
        border-color: #fff;
        color: #fff;
        transform: scale(1.05);
      }

      /* Main Content */
      .main-content {
        flex: 1;
        overflow-y: auto;
        padding: 30px;
        background: #121212;
      }

      .section-title {
        font-size: 24px;
        margin-bottom: 20px;
        font-weight: bold;
      }

      /* Search Results */
      .search-results {
        display: none;
      }

      .track-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .track-item {
        display: flex;
        align-items: center;
        padding: 10px;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.3s;
      }

      .track-item:hover {
        background: #2a2a2a;
      }

      .track-album-art {
        width: 50px;
        height: 50px;
        border-radius: 4px;
        margin-right: 15px;
        object-fit: cover;
      }

      .track-info {
        flex: 1;
      }

      .track-name {
        font-size: 16px;
        margin-bottom: 5px;
      }

      .track-artist {
        font-size: 14px;
        color: #b3b3b3;
      }

      .track-duration {
        color: #b3b3b3;
        font-size: 14px;
      }

      /* Now Playing */
      .now-playing-section {
        text-align: center;
        padding: 40px;
      }

      .now-playing-art {
        width: 300px;
        height: 300px;
        border-radius: 8px;
        margin: 0 auto 30px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
      }

      .now-playing-title {
        font-size: 32px;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .now-playing-artist {
        font-size: 18px;
        color: #b3b3b3;
        margin-bottom: 30px;
      }

      /* Player Controls */
      .player-controls {
        background: #181818;
        padding: 20px 30px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-top: 1px solid #282828;
      }

      .current-track {
        display: flex;
        align-items: center;
        gap: 15px;
        flex: 1;
        min-width: 0;
      }

      .current-track-art {
        width: 60px;
        height: 60px;
        border-radius: 4px;
        object-fit: cover;
      }

      .current-track-info {
        min-width: 0;
      }

      .current-track-name {
        font-size: 14px;
        font-weight: bold;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .current-track-artist {
        font-size: 12px;
        color: #b3b3b3;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .control-buttons {
        display: flex;
        gap: 20px;
        align-items: center;
        justify-content: center;
        flex: 1;
      }

      .control-btn {
        background: transparent;
        border: none;
        color: #b3b3b3;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 18px;
        padding: 10px;
      }

      .control-btn:hover {
        color: #fff;
        transform: scale(1.1);
      }

      .play-btn {
        background: #fff;
        color: #000;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
      }

      .play-btn:hover {
        transform: scale(1.1);
      }

      .volume-control {
        display: flex;
        align-items: center;
        gap: 10px;
        flex: 1;
        justify-content: flex-end;
      }

      .volume-slider {
        width: 100px;
        cursor: pointer;
      }

      /* Progress Bar */
      .progress-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
      }

      .progress-time {
        font-size: 12px;
        color: #b3b3b3;
        min-width: 40px;
      }

      .progress-bar {
        flex: 1;
        height: 4px;
        background: #404040;
        border-radius: 2px;
        cursor: pointer;
        position: relative;
      }

      .progress-fill {
        height: 100%;
        background: #1db954;
        border-radius: 2px;
        transition: width 0.1s;
      }

      .progress-bar:hover .progress-fill {
        background: #1ed760;
      }

      /* Loading */
      .loading {
        text-align: center;
        padding: 40px;
        color: #b3b3b3;
      }

      /* Scrollbar */
      ::-webkit-scrollbar {
        width: 12px;
      }

      ::-webkit-scrollbar-track {
        background: #121212;
      }

      ::-webkit-scrollbar-thumb {
        background: #282828;
        border-radius: 6px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #3e3e3e;
      }
    </style>
  </head>
  <body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
      <div class="login-container">
        <h1>üéµ X-ORBIT Music</h1>
        <p>Powered by Spotify ‚Ä¢ Premium Required</p>
        <button class="login-btn" onclick="login()">Login with Spotify</button>
      </div>
    </div>

    <!-- Main Player -->
    <div class="player-container" id="playerContainer">
      <!-- Top Bar -->
      <div class="top-bar">
        <div class="search-container">
          <input
            type="text"
            class="search-input"
            id="searchInput"
            placeholder="Search for songs, artists, or albums..."
          />
        </div>
        <div class="user-info">
          <span id="userName">User</span>
          <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content" id="mainContent">
        <!-- Now Playing -->
        <div class="now-playing-section" id="nowPlayingSection">
          <img
            src="https://via.placeholder.com/300?text=No+Track+Playing"
            class="now-playing-art"
            id="nowPlayingArt"
          />
          <div class="now-playing-title" id="nowPlayingTitle">
            No track playing
          </div>
          <div class="now-playing-artist" id="nowPlayingArtist">
            Select a song to start
          </div>
        </div>

        <!-- Search Results -->
        <div class="search-results" id="searchResults">
          <h2 class="section-title">Search Results</h2>
          <div class="track-list" id="trackList"></div>
        </div>
      </div>

      <!-- Player Controls -->
      <div class="player-controls">
        <div class="current-track">
          <img
            src="https://via.placeholder.com/60?text=‚ô™"
            class="current-track-art"
            id="currentTrackArt"
          />
          <div class="current-track-info">
            <div class="current-track-name" id="currentTrackName">No track</div>
            <div class="current-track-artist" id="currentTrackArtist">-</div>
          </div>
        </div>

        <div style="flex: 1">
          <div class="control-buttons">
            <button class="control-btn" onclick="previousTrack()">‚èÆ</button>
            <button
              class="control-btn play-btn"
              id="playBtn"
              onclick="togglePlay()"
            >
              ‚ñ∂
            </button>
            <button class="control-btn" onclick="nextTrack()">‚è≠</button>
          </div>
          <div class="progress-container">
            <span class="progress-time" id="currentTime">0:00</span>
            <div
              class="progress-bar"
              id="progressBar"
              onclick="seekTrack(event)"
            >
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <span class="progress-time" id="totalTime">0:00</span>
          </div>
        </div>

        <div class="volume-control">
          <span>üîä</span>
          <input
            type="range"
            class="volume-slider"
            id="volumeSlider"
            min="0"
            max="100"
            value="50"
          />
        </div>
      </div>
    </div>

    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    <script>
      const CLIENT_ID = "48dbdebd797842549795d880459bba50";
      const REDIRECT_URI = "https://xorbit.org/spotify-player.html";
      const SCOPES =
        "streaming user-read-email user-read-private user-read-playback-state user-modify-playback-state";

      let player;
      let deviceId;
      let currentTrack = null;
      let accessToken = null;

      // Login function
      function login() {
        const authUrl = `https://accounts.spotify.com/authorize?client_id=${CLIENT_ID}&response_type=token&redirect_uri=${encodeURIComponent(
          REDIRECT_URI
        )}&scope=${encodeURIComponent(SCOPES)}`;
        window.location.href = authUrl;
      }

      // Logout function
      function logout() {
        localStorage.removeItem("spotify_access_token");
        window.location.reload();
      }

      // Get access token from URL or localStorage
      function getAccessToken() {
        // Check URL hash first
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        const token = params.get("access_token");

        if (token) {
          localStorage.setItem("spotify_access_token", token);
          window.location.hash = ""; // Clean URL
          return token;
        }

        // Check localStorage
        return localStorage.getItem("spotify_access_token");
      }

      // Initialize player
      window.onSpotifyWebPlaybackSDKReady = () => {
        accessToken = getAccessToken();

        if (!accessToken) {
          document.getElementById("loginScreen").style.display = "flex";
          return;
        }

        // Show player
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("playerContainer").style.display = "flex";

        // Get user info
        fetch("https://api.spotify.com/v1/me", {
          headers: {
            Authorization: `Bearer ${accessToken}`,
          },
        })
          .then((response) => response.json())
          .then((data) => {
            document.getElementById("userName").textContent = data.display_name;
          });

        // Initialize player
        player = new Spotify.Player({
          name: "X-ORBIT Music Player",
          getOAuthToken: (cb) => {
            cb(accessToken);
          },
          volume: 0.5,
        });

        // Error handling
        player.addListener("initialization_error", ({ message }) => {
          console.error("Failed to initialize", message);
        });

        player.addListener("authentication_error", ({ message }) => {
          console.error("Failed to authenticate", message);
          logout();
        });

        player.addListener("account_error", ({ message }) => {
          console.error("Failed to validate account", message);
          alert("Spotify Premium is required to use this player.");
        });

        player.addListener("playback_error", ({ message }) => {
          console.error("Failed to perform playback", message);
        });

        // Ready
        player.addListener("ready", ({ device_id }) => {
          console.log("Ready with Device ID", device_id);
          deviceId = device_id;
        });

        player.addListener("not_ready", ({ device_id }) => {
          console.log("Device ID has gone offline", device_id);
        });

        // Player state changed
        player.addListener("player_state_changed", (state) => {
          if (!state) return;

          currentTrack = state.track_window.current_track;
          updateNowPlaying(currentTrack);
          updatePlayerControls(state);
        });

        // Connect to player
        player.connect();
      };

      // Update now playing display
      function updateNowPlaying(track) {
        if (!track) return;

        document.getElementById("nowPlayingArt").src =
          track.album.images[0].url;
        document.getElementById("nowPlayingTitle").textContent = track.name;
        document.getElementById("nowPlayingArtist").textContent = track.artists
          .map((a) => a.name)
          .join(", ");

        document.getElementById("currentTrackArt").src =
          track.album.images[0].url;
        document.getElementById("currentTrackName").textContent = track.name;
        document.getElementById("currentTrackArtist").textContent =
          track.artists.map((a) => a.name).join(", ");
      }

      // Update player controls
      function updatePlayerControls(state) {
        const playBtn = document.getElementById("playBtn");
        playBtn.textContent = state.paused ? "‚ñ∂" : "‚è∏";

        // Update progress
        const position = state.position;
        const duration = state.duration;

        document.getElementById("currentTime").textContent =
          formatTime(position);
        document.getElementById("totalTime").textContent = formatTime(duration);

        const progress = (position / duration) * 100;
        document.getElementById("progressFill").style.width = progress + "%";
      }

      // Format time
      function formatTime(ms) {
        const seconds = Math.floor(ms / 1000);
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins}:${secs.toString().padStart(2, "0")}`;
      }

      // Toggle play/pause
      function togglePlay() {
        player.togglePlay();
      }

      // Previous track
      function previousTrack() {
        player.previousTrack();
      }

      // Next track
      function nextTrack() {
        player.nextTrack();
      }

      // Seek track
      function seekTrack(event) {
        player.getCurrentState().then((state) => {
          if (!state) return;

          const rect = event.currentTarget.getBoundingClientRect();
          const percent = (event.clientX - rect.left) / rect.width;
          const position = Math.floor(percent * state.duration);

          player.seek(position);
        });
      }

      // Volume control
      document.getElementById("volumeSlider").addEventListener("input", (e) => {
        player.setVolume(e.target.value / 100);
      });

      // Search functionality
      let searchTimeout;
      document.getElementById("searchInput").addEventListener("input", (e) => {
        clearTimeout(searchTimeout);
        const query = e.target.value.trim();

        if (!query) {
          document.getElementById("searchResults").style.display = "none";
          document.getElementById("nowPlayingSection").style.display = "block";
          return;
        }

        searchTimeout = setTimeout(() => {
          searchTracks(query);
        }, 500);
      });

      // Search tracks
      function searchTracks(query) {
        fetch(
          `https://api.spotify.com/v1/search?q=${encodeURIComponent(
            query
          )}&type=track&limit=20`,
          {
            headers: {
              Authorization: `Bearer ${accessToken}`,
            },
          }
        )
          .then((response) => response.json())
          .then((data) => {
            displaySearchResults(data.tracks.items);
          })
          .catch((error) => {
            console.error("Search error:", error);
          });
      }

      // Display search results
      function displaySearchResults(tracks) {
        const trackList = document.getElementById("trackList");
        trackList.innerHTML = "";

        document.getElementById("nowPlayingSection").style.display = "none";
        document.getElementById("searchResults").style.display = "block";

        tracks.forEach((track) => {
          const trackItem = document.createElement("div");
          trackItem.className = "track-item";
          trackItem.onclick = () => playTrack(track.uri);

          trackItem.innerHTML = `
                    <img src="${
                      track.album.images[2]?.url || track.album.images[0]?.url
                    }" class="track-album-art">
                    <div class="track-info">
                        <div class="track-name">${track.name}</div>
                        <div class="track-artist">${track.artists
                          .map((a) => a.name)
                          .join(", ")}</div>
                    </div>
                    <div class="track-duration">${formatTime(
                      track.duration_ms
                    )}</div>
                `;

          trackList.appendChild(trackItem);
        });
      }

      // Play track
      function playTrack(uri) {
        fetch(
          `https://api.spotify.com/v1/me/player/play?device_id=${deviceId}`,
          {
            method: "PUT",
            headers: {
              Authorization: `Bearer ${accessToken}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              uris: [uri],
            }),
          }
        )
          .then(() => {
            // Hide search results and show now playing
            document.getElementById("searchResults").style.display = "none";
            document.getElementById("nowPlayingSection").style.display =
              "block";
            document.getElementById("searchInput").value = "";
          })
          .catch((error) => {
            console.error("Playback error:", error);
          });
      }

      // Update progress bar continuously
      setInterval(() => {
        player?.getCurrentState().then((state) => {
          if (!state || state.paused) return;
          updatePlayerControls(state);
        });
      }, 1000);
    </script>
  </body>
</html>
